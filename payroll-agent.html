<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê¸‰ì—¬Â·ì„¸ê¸ˆ ìë™í™” ì—ì´ì „íŠ¸</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=JetBrains+Mono:wght@400;600&display=swap');

  :root {
    --bg: #0a0e1a;
    --surface: #111827;
    --surface2: #1a2235;
    --border: #1e2d47;
    --accent: #00d4aa;
    --accent2: #3b82f6;
    --accent3: #f59e0b;
    --text: #e2e8f0;
    --text-muted: #64748b;
    --danger: #ef4444;
    --success: #10b981;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Noto Sans KR', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* Header */
  header {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 0 24px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 700;
    font-size: 16px;
    color: var(--accent);
    letter-spacing: -0.5px;
  }

  .logo-icon {
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
  }

  .header-date {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    color: var(--text-muted);
  }

  /* Layout */
  .app {
    display: grid;
    grid-template-columns: 220px 1fr;
    flex: 1;
    height: calc(100vh - 60px);
  }

  /* Sidebar */
  .sidebar {
    background: var(--surface);
    border-right: 1px solid var(--border);
    padding: 20px 0;
    overflow-y: auto;
  }

  .nav-section {
    margin-bottom: 8px;
  }

  .nav-label {
    padding: 6px 20px;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 1.5px;
    color: var(--text-muted);
    text-transform: uppercase;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 20px;
    cursor: pointer;
    transition: all 0.15s;
    font-size: 14px;
    color: var(--text-muted);
    border-left: 3px solid transparent;
  }

  .nav-item:hover {
    background: var(--surface2);
    color: var(--text);
  }

  .nav-item.active {
    background: rgba(0, 212, 170, 0.08);
    color: var(--accent);
    border-left-color: var(--accent);
  }

  .nav-icon { font-size: 16px; }

  /* Deadline badges */
  .badge {
    margin-left: auto;
    background: var(--danger);
    color: white;
    font-size: 10px;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 10px;
  }

  .badge.soon { background: var(--accent3); }

  /* Main content */
  .main {
    overflow-y: auto;
    padding: 24px;
    display: none;
  }

  .main.active { display: block; }

  .page-title {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 4px;
    letter-spacing: -0.5px;
  }

  .page-sub {
    color: var(--text-muted);
    font-size: 13px;
    margin-bottom: 24px;
  }

  /* Cards */
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 16px;
  }

  .card-title {
    font-size: 14px;
    font-weight: 700;
    margin-bottom: 16px;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* Grid */
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }

  /* Stat cards */
  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 18px;
  }

  .stat-label {
    font-size: 11px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
  }

  .stat-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 24px;
    font-weight: 600;
    color: var(--accent);
  }

  .stat-note {
    font-size: 11px;
    color: var(--text-muted);
    margin-top: 4px;
  }

  /* Deadline timeline */
  .deadline-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
  }

  .deadline-item:last-child { border-bottom: none; }

  .deadline-date {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    color: var(--text-muted);
    width: 80px;
    flex-shrink: 0;
  }

  .deadline-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .deadline-info { flex: 1; }
  .deadline-name { font-size: 13px; font-weight: 500; }
  .deadline-org { font-size: 11px; color: var(--text-muted); }

  .deadline-status {
    font-size: 11px;
    padding: 3px 8px;
    border-radius: 20px;
    font-weight: 600;
  }

  .status-urgent { background: rgba(239,68,68,0.15); color: var(--danger); }
  .status-soon { background: rgba(245,158,11,0.15); color: var(--accent3); }
  .status-ok { background: rgba(16,185,129,0.15); color: var(--success); }

  /* Form styles */
  .form-group {
    margin-bottom: 14px;
  }

  label {
    display: block;
    font-size: 12px;
    font-weight: 600;
    color: var(--text-muted);
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  input, select {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 12px;
    color: var(--text);
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s;
  }

  input:focus, select:focus {
    border-color: var(--accent);
  }

  select option { background: var(--surface); }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 10px 18px;
    border-radius: 8px;
    border: none;
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-primary {
    background: var(--accent);
    color: #0a0e1a;
  }

  .btn-primary:hover {
    background: #00bfa0;
    transform: translateY(-1px);
  }

  .btn-secondary {
    background: var(--surface2);
    color: var(--text);
    border: 1px solid var(--border);
  }

  .btn-secondary:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  /* Result box */
  .result-box {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 16px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    line-height: 1.8;
    white-space: pre-wrap;
    min-height: 80px;
    color: var(--text);
  }

  /* AI chat area */
  .chat-container {
    display: flex;
    flex-direction: column;
    height: calc(100vh - 160px);
  }

  .chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 16px 0;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .msg {
    max-width: 80%;
    padding: 12px 16px;
    border-radius: 12px;
    font-size: 14px;
    line-height: 1.6;
  }

  .msg-user {
    background: var(--accent2);
    color: white;
    align-self: flex-end;
    border-bottom-right-radius: 4px;
  }

  .msg-ai {
    background: var(--surface2);
    border: 1px solid var(--border);
    align-self: flex-start;
    border-bottom-left-radius: 4px;
  }

  .msg-ai pre {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    background: var(--bg);
    padding: 12px;
    border-radius: 6px;
    margin-top: 8px;
    overflow-x: auto;
    white-space: pre-wrap;
  }

  .chat-input-area {
    display: flex;
    gap: 10px;
    padding-top: 16px;
    border-top: 1px solid var(--border);
  }

  .chat-input {
    flex: 1;
    resize: none;
    height: 48px;
    padding: 12px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 14px;
    outline: none;
  }

  .chat-input:focus { border-color: var(--accent); }

  /* Insurance table */
  .ins-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
  }

  .ins-table th {
    background: var(--surface2);
    padding: 10px 12px;
    text-align: left;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-muted);
    border-bottom: 1px solid var(--border);
  }

  .ins-table td {
    padding: 10px 12px;
    border-bottom: 1px solid rgba(30,45,71,0.5);
    font-family: 'JetBrains Mono', monospace;
  }

  .ins-table tr:hover td { background: var(--surface2); }

  .ins-row-total td {
    font-weight: 700;
    color: var(--accent);
    border-top: 1px solid var(--border);
  }

  /* Tabs */
  .tabs {
    display: flex;
    gap: 4px;
    margin-bottom: 20px;
    background: var(--surface2);
    padding: 4px;
    border-radius: 10px;
    width: fit-content;
  }

  .tab {
    padding: 8px 16px;
    border-radius: 7px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    color: var(--text-muted);
    transition: all 0.2s;
  }

  .tab.active {
    background: var(--accent);
    color: #0a0e1a;
    font-weight: 700;
  }

  /* Loading dots */
  .loading {
    display: inline-flex;
    gap: 4px;
    align-items: center;
  }

  .loading span {
    width: 6px;
    height: 6px;
    background: var(--accent);
    border-radius: 50%;
    animation: bounce 1.2s infinite;
  }

  .loading span:nth-child(2) { animation-delay: 0.2s; }
  .loading span:nth-child(3) { animation-delay: 0.4s; }

  @keyframes bounce {
    0%, 60%, 100% { transform: translateY(0); }
    30% { transform: translateY(-6px); }
  }

  /* Payslip preview */
  .payslip {
    background: white;
    color: #111;
    padding: 24px;
    border-radius: 8px;
    font-size: 12px;
    max-width: 500px;
  }

  .payslip h3 {
    text-align: center;
    font-size: 16px;
    margin-bottom: 16px;
    color: #000;
    border-bottom: 2px solid #000;
    padding-bottom: 8px;
  }

  .payslip table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 12px;
  }

  .payslip table th {
    background: #f0f0f0;
    padding: 6px 8px;
    border: 1px solid #ccc;
    font-weight: 700;
  }

  .payslip table td {
    padding: 6px 8px;
    border: 1px solid #ccc;
  }

  .payslip .total-row {
    font-weight: 700;
    background: #e8f5e9;
  }

  .divider {
    height: 1px;
    background: var(--border);
    margin: 20px 0;
  }

  textarea {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 12px;
    color: var(--text);
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 14px;
    outline: none;
    resize: vertical;
  }

  textarea:focus { border-color: var(--accent); }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-icon">ğŸ¤–</div>
    ê¸‰ì—¬Â·ì„¸ê¸ˆ ìë™í™” ì—ì´ì „íŠ¸
  </div>
  <div class="header-date" id="headerDate"></div>
</header>

<div class="app">
  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="nav-section">
      <div class="nav-label">ëŒ€ì‹œë³´ë“œ</div>
      <div class="nav-item active" data-page="dashboard">
        <span class="nav-icon">ğŸ“Š</span> ì‹ ê³  ì¼ì • í˜„í™©
      </div>
    </div>
    <div class="nav-section">
      <div class="nav-label">AI ì—ì´ì „íŠ¸</div>
      <div class="nav-item" data-page="chat">
        <span class="nav-icon">ğŸ¤–</span> AI ìƒë‹´ Â· ìë™í™”
      </div>
    </div>
    <div class="nav-section">
      <div class="nav-label">4ëŒ€ë³´í—˜</div>
      <div class="nav-item" data-page="insurance">
        <span class="nav-icon">ğŸ›¡ï¸</span> ë³´í—˜ë£Œ ê³„ì‚°
        <span class="badge soon">D-8</span>
      </div>
    </div>
    <div class="nav-section">
      <div class="nav-label">ì„¸ê¸ˆ ì‹ ê³ </div>
      <div class="nav-item" data-page="withholding">
        <span class="nav-icon">ğŸ“‹</span> ì›ì²œì„¸ ì‹ ê³ 
        <span class="badge">D-2</span>
      </div>
    </div>
    <div class="nav-section">
      <div class="nav-label">ê¸‰ì—¬ ê´€ë¦¬</div>
      <div class="nav-item" data-page="payslip">
        <span class="nav-icon">ğŸ’°</span> ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„±
      </div>
    </div>
    <div class="nav-section">
      <div class="nav-label">ì§€ê¸‰ëª…ì„¸ì„œ</div>
      <div class="nav-item" data-page="simplified">
        <span class="nav-icon">ğŸ“‘</span> ê°„ì´ì§€ê¸‰ëª…ì„¸ì„œ
        <span class="badge soon">3ì›”</span>
      </div>
      <div class="nav-item" data-page="annual">
        <span class="nav-icon">ğŸ“ƒ</span> ê·¼ë¡œì†Œë“ì§€ê¸‰ëª…ì„¸ì„œ
        <span class="badge soon">3ì›”</span>
      </div>
    </div>
  </nav>

  <!-- Dashboard -->
  <div class="main active" id="page-dashboard">
    <div class="page-title">ì‹ ê³  ì¼ì • í˜„í™©</div>
    <div class="page-sub">2025ë…„ 2ì›” ê¸°ì¤€ Â· ì£¼ìš” ì„¸ë¬´Â·4ëŒ€ë³´í—˜ ì‹ ê³  ì¼ì •</div>

    <div class="grid-3" style="margin-bottom:20px;">
      <div class="stat-card">
        <div class="stat-label">ì´ë²ˆ ë‹¬ ì‹ ê³  ê±´ìˆ˜</div>
        <div class="stat-value">4</div>
        <div class="stat-note">2ì›” ë§ˆê° ê¸°ì¤€</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">ê¸´ê¸‰ ë§ˆê° (D-7 ì´ë‚´)</div>
        <div class="stat-value" style="color:var(--danger);">2</div>
        <div class="stat-note">ì¦‰ì‹œ ì²˜ë¦¬ í•„ìš”</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">ì™„ë£Œëœ ì‹ ê³ </div>
        <div class="stat-value" style="color:var(--success);">1</div>
        <div class="stat-note">ì´ë²ˆ ë‹¬ ê¸°ì¤€</div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">ğŸ“… 2ì›” ì‹ ê³  ìº˜ë¦°ë”</div>

      <div class="deadline-item">
        <div class="deadline-date">02.10</div>
        <div class="deadline-dot" style="background:var(--success)"></div>
        <div class="deadline-info">
          <div class="deadline-name">1ì›”ë¶„ ì›ì²œì„¸ ì‹ ê³ Â·ë‚©ë¶€</div>
          <div class="deadline-org">êµ­ì„¸ì²­ í™ˆíƒìŠ¤</div>
        </div>
        <div class="deadline-status status-ok">ì™„ë£Œ</div>
      </div>

      <div class="deadline-item">
        <div class="deadline-date">02.17</div>
        <div class="deadline-dot" style="background:var(--danger)"></div>
        <div class="deadline-info">
          <div class="deadline-name">1ì›”ë¶„ ì›ì²œì„¸ ë°˜ê¸°ë‚©ë¶€</div>
          <div class="deadline-org">êµ­ì„¸ì²­ í™ˆíƒìŠ¤</div>
        </div>
        <div class="deadline-status status-urgent">D-2</div>
      </div>

      <div class="deadline-item">
        <div class="deadline-date">02.25</div>
        <div class="deadline-dot" style="background:var(--accent3)"></div>
        <div class="deadline-info">
          <div class="deadline-name">4ëŒ€ë³´í—˜ 2ì›”ë¶„ ë³´í—˜ë£Œ ë‚©ë¶€</div>
          <div class="deadline-org">êµ­ë¯¼ê±´ê°•ë³´í—˜ê³µë‹¨</div>
        </div>
        <div class="deadline-status status-soon">D-10</div>
      </div>

      <div class="deadline-item">
        <div class="deadline-date">03.10</div>
        <div class="deadline-dot" style="background:var(--accent2)"></div>
        <div class="deadline-info">
          <div class="deadline-name">2024ë…„ ê·¼ë¡œì†Œë“ ì§€ê¸‰ëª…ì„¸ì„œ ì œì¶œ</div>
          <div class="deadline-org">êµ­ì„¸ì²­ í™ˆíƒìŠ¤</div>
        </div>
        <div class="deadline-status status-ok">ì¤€ë¹„ì¤‘</div>
      </div>

      <div class="deadline-item">
        <div class="deadline-date">03.10</div>
        <div class="deadline-dot" style="background:var(--accent2)"></div>
        <div class="deadline-info">
          <div class="deadline-name">2ì›”ë¶„ ì›ì²œì„¸ ì‹ ê³ Â·ë‚©ë¶€</div>
          <div class="deadline-org">êµ­ì„¸ì²­ í™ˆíƒìŠ¤</div>
        </div>
        <div class="deadline-status status-ok">ì¤€ë¹„ì¤‘</div>
      </div>

      <div class="deadline-item">
        <div class="deadline-date">01.31</div>
        <div class="deadline-dot" style="background:var(--accent3)"></div>
        <div class="deadline-info">
          <div class="deadline-name">2024ë…„ í•˜ë°˜ê¸° ê°„ì´ì§€ê¸‰ëª…ì„¸ì„œ ì œì¶œ</div>
          <div class="deadline-org">êµ­ì„¸ì²­ í™ˆíƒìŠ¤ (ìƒë°˜ê¸°: 7/31)</div>
        </div>
        <div class="deadline-status status-ok">ì™„ë£Œ</div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">âš¡ ë¹ ë¥¸ ì‹¤í–‰</div>
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <button class="btn btn-primary" onclick="navigate('insurance')">ğŸ›¡ï¸ ë³´í—˜ë£Œ ê³„ì‚°í•˜ê¸°</button>
        <button class="btn btn-secondary" onclick="navigate('withholding')">ğŸ“‹ ì›ì²œì„¸ ì‹ ê³ ì„œ ì‘ì„±</button>
        <button class="btn btn-secondary" onclick="navigate('payslip')">ğŸ’° ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„±</button>
        <button class="btn btn-secondary" onclick="navigate('simplified')">ğŸ“‘ ê°„ì´ì§€ê¸‰ëª…ì„¸ì„œ</button>
        <button class="btn btn-secondary" onclick="navigate('annual')">ğŸ“ƒ ê·¼ë¡œì†Œë“ì§€ê¸‰ëª…ì„¸ì„œ</button>
        <button class="btn btn-secondary" onclick="navigate('chat')">ğŸ¤– AIì—ê²Œ ì§ˆë¬¸í•˜ê¸°</button>
      </div>
    </div>
  </div>

  <!-- AI Chat -->
  <div class="main" id="page-chat">
    <div class="page-title">AI ìƒë‹´ Â· ìë™í™”</div>
    <div class="page-sub">ê¸‰ì—¬, ì„¸ê¸ˆ, 4ëŒ€ë³´í—˜ ê´€ë ¨ ì§ˆë¬¸ì„ ììœ ë¡­ê²Œ ë¬¼ì–´ë³´ì„¸ìš”</div>

    <div class="card" style="height: calc(100vh - 200px); display:flex; flex-direction:column;">
      <div class="chat-messages" id="chatMessages">
        <div class="msg msg-ai">
          ì•ˆë…•í•˜ì„¸ìš”! ê¸‰ì—¬Â·ì„¸ê¸ˆ ìë™í™” AI ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤. ğŸ¤–<br><br>
          ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ ë„ì™€ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤:<br>
          â€¢ 4ëŒ€ë³´í—˜ ë³´í—˜ë£Œ ê³„ì‚° ë° ì‹ ê³  ì•ˆë‚´<br>
          â€¢ ì›ì²œì„¸ ê³„ì‚° ë° ì‹ ê³  ì ˆì°¨<br>
          â€¢ ê¸‰ì—¬ ëª…ì„¸ì„œ ì‘ì„± ë„ì›€<br>
          â€¢ ì„¸ë¬´Â·ë…¸ë¬´ ê´€ë ¨ ì§ˆë¬¸ ë‹µë³€<br><br>
          ë¬´ì—‡ì´ë“  ì§ˆë¬¸í•´ ì£¼ì„¸ìš”!
        </div>
      </div>
      <div class="chat-input-area">
        <textarea class="chat-input" id="chatInput" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”... (ì˜ˆ: ì›”ê¸‰ 300ë§Œì› ì§ì›ì˜ 4ëŒ€ë³´í—˜ë£ŒëŠ” ì–¼ë§ˆì¸ê°€ìš”?)" rows="2"></textarea>
        <button class="btn btn-primary" id="sendBtn" onclick="sendChat()">ì „ì†¡</button>
      </div>
    </div>
  </div>

  <!-- Insurance Calculator -->
  <div class="main" id="page-insurance">
    <div class="page-title">4ëŒ€ë³´í—˜ ë³´í—˜ë£Œ ê³„ì‚°ê¸°</div>
    <div class="page-sub">ì›” ê¸‰ì—¬ ê¸°ì¤€ 4ëŒ€ë³´í—˜(êµ­ë¯¼ì—°ê¸ˆÂ·ê±´ê°•ë³´í—˜Â·ê³ ìš©ë³´í—˜Â·ì‚°ì¬ë³´í—˜) ìë™ ê³„ì‚°</div>

    <div class="grid-2">
      <div>
        <div class="card">
          <div class="card-title">ğŸ“ ì…ë ¥ ì •ë³´</div>
          <div class="form-group">
            <label>ì›” ê¸°ë³¸ê¸‰ (ì›)</label>
            <input type="number" id="baseSalary" placeholder="3,000,000" value="3000000">
          </div>
          <div class="form-group">
            <label>ì§ì› ìœ í˜•</label>
            <select id="empType">
              <option value="regular">ì •ê·œì§</option>
              <option value="part">ë‹¨ì‹œê°„ ê·¼ë¡œì</option>
            </select>
          </div>
          <div class="form-group">
            <label>ì—…ì¢… ì‚°ì¬ë³´í—˜ë£Œìœ¨</label>
            <select id="industryRate">
              <option value="0.007">ì¼ë°˜ ì‚¬ë¬´ì§ (0.7%)</option>
              <option value="0.009">ì„œë¹„ìŠ¤ì—… (0.9%)</option>
              <option value="0.011">ì œì¡°ì—… (1.1%)</option>
              <option value="0.018">ê±´ì„¤ì—… (1.8%)</option>
            </select>
          </div>
          <button class="btn btn-primary" style="width:100%" onclick="calcInsurance()">
            ğŸ”¢ ë³´í—˜ë£Œ ê³„ì‚°í•˜ê¸°
          </button>
        </div>
      </div>

      <div>
        <div class="card" id="insResult" style="display:none;">
          <div class="card-title">ğŸ“Š ê³„ì‚° ê²°ê³¼ <span style="font-size:11px; color:var(--text-muted); font-weight:400;" id="calcDate"></span></div>
          <table class="ins-table">
            <thead>
              <tr>
                <th>ë³´í—˜ ì¢…ë¥˜</th>
                <th>ìš”ìœ¨</th>
                <th>ê·¼ë¡œì ë¶€ë‹´</th>
                <th>ì‚¬ì—…ì£¼ ë¶€ë‹´</th>
              </tr>
            </thead>
            <tbody id="insTableBody"></tbody>
          </table>
          <div style="margin-top:14px;">
            <button class="btn btn-secondary" onclick="generateInsReport()">ğŸ“„ ì‹ ê³ ì„œ ì´ˆì•ˆ ìƒì„±</button>
          </div>
        </div>

        <div class="card" id="insPlaceholder">
          <div style="text-align:center; padding:40px 0; color:var(--text-muted);">
            <div style="font-size:48px; margin-bottom:12px;">ğŸ›¡ï¸</div>
            <div>ê¸‰ì—¬ë¥¼ ì…ë ¥í•˜ê³  ê³„ì‚°í•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”</div>
          </div>
        </div>
      </div>
    </div>

    <!-- AI Generated Report -->
    <div class="card" id="insReport" style="display:none;">
      <div class="card-title">ğŸ“„ AI ìƒì„± ì‹ ê³ ì„œ ì´ˆì•ˆ</div>
      <div class="result-box" id="insReportContent">
        <div class="loading"><span></span><span></span><span></span></div>
      </div>
      <div style="margin-top:12px; display:flex; gap:8px;">
        <button class="btn btn-primary" onclick="copyReport('insReportContent')">ğŸ“‹ ë³µì‚¬</button>
        <button class="btn btn-secondary" onclick="navigate('chat')">ğŸ¤– AIì—ê²Œ ë” ë¬¼ì–´ë³´ê¸°</button>
      </div>
    </div>
  </div>

  <!-- Withholding Tax -->
  <div class="main" id="page-withholding">
    <div class="page-title">ì›ì²œì„¸ ì‹ ê³ ì„œ ì‘ì„±</div>
    <div class="page-sub">ì†Œë“ì„¸ ë° ì§€ë°©ì†Œë“ì„¸ ì›ì²œì§•ìˆ˜ ì‹ ê³  ìë™í™”</div>

    <div class="tabs">
      <div class="tab active" onclick="switchTab(this, 'wt-calc')">ì„¸ì•¡ ê³„ì‚°</div>
      <div class="tab" onclick="switchTab(this, 'wt-report')">ì‹ ê³ ì„œ ì´ˆì•ˆ</div>
    </div>

    <div id="wt-calc">
      <div class="grid-2">
        <div class="card">
          <div class="card-title">ğŸ“ ì†Œë“ ì •ë³´ ì…ë ¥</div>
          <div class="form-group">
            <label>ì†Œë“ ìœ í˜•</label>
            <select id="incomeType">
              <option value="salary">ê·¼ë¡œì†Œë“</option>
              <option value="business">ì‚¬ì—…ì†Œë“</option>
              <option value="etc">ê¸°íƒ€ì†Œë“</option>
              <option value="retirement">í‡´ì§ì†Œë“</option>
            </select>
          </div>
          <div class="form-group">
            <label>ì´ ì§€ê¸‰ì•¡ (ì›)</label>
            <input type="number" id="totalPay" placeholder="3,000,000" value="3000000">
          </div>
          <div class="form-group">
            <label>ë¶€ì–‘ê°€ì¡± ìˆ˜ (ë³¸ì¸ í¬í•¨)</label>
            <input type="number" id="dependents" value="1" min="1" max="10">
          </div>
          <div class="form-group">
            <label>ì§€ê¸‰ ì—°ì›”</label>
            <input type="month" id="payMonth" value="2025-01">
          </div>
          <button class="btn btn-primary" style="width:100%" onclick="calcWithholding()">
            ğŸ”¢ ì›ì²œì„¸ ê³„ì‚°í•˜ê¸°
          </button>
        </div>

        <div class="card" id="wtResult" style="display:none;">
          <div class="card-title">ğŸ’° ì›ì²œì§•ìˆ˜ì„¸ì•¡</div>
          <div id="wtResultContent"></div>
        </div>

        <div class="card" id="wtPlaceholder">
          <div style="text-align:center; padding:40px 0; color:var(--text-muted);">
            <div style="font-size:48px; margin-bottom:12px;">ğŸ“‹</div>
            <div>ì†Œë“ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ê³„ì‚°í•´ì£¼ì„¸ìš”</div>
          </div>
        </div>
      </div>
    </div>

    <div id="wt-report" style="display:none;">
      <div class="card">
        <div class="card-title">ğŸ“„ ì›ì²œì„¸ ì‹ ê³ ì„œ ì´ˆì•ˆ (AI ìƒì„±)</div>
        <div class="form-group">
          <label>ì‹ ê³  ìœ í˜•</label>
          <select id="reportType">
            <option value="monthly">ë§¤ì›” ì‹ ê³  (ì¼ë°˜)</option>
            <option value="biannual">ë°˜ê¸° ì‹ ê³ </option>
          </select>
        </div>
        <div class="form-group">
          <label>ê·€ì† ì—°ì›”</label>
          <input type="month" id="reportMonth" value="2025-01">
        </div>
        <div class="form-group">
          <label>ì´ ì§€ê¸‰ì¸ì› ìˆ˜</label>
          <input type="number" id="empCount" value="5">
        </div>
        <div class="form-group">
          <label>ì´ ì§€ê¸‰ê¸ˆì•¡ (ì›)</label>
          <input type="number" id="totalPayAmount" value="15000000">
        </div>
        <button class="btn btn-primary" onclick="generateWTReport()">ğŸ¤– AI ì‹ ê³ ì„œ ì´ˆì•ˆ ìƒì„±</button>
      </div>

      <div class="card" id="wtReportCard" style="display:none;">
        <div class="card-title">ğŸ“„ ì‹ ê³ ì„œ ì´ˆì•ˆ</div>
        <div class="result-box" id="wtReportContent"></div>
        <div style="margin-top:12px;">
          <button class="btn btn-primary" onclick="copyReport('wtReportContent')">ğŸ“‹ ë³µì‚¬</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Payslip Generator -->
  <div class="main" id="page-payslip">
    <div class="page-title">ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„±</div>
    <div class="page-sub">ì§ì› ì •ë³´ ì…ë ¥ í›„ ìë™ìœ¼ë¡œ ê¸‰ì—¬ëª…ì„¸ì„œë¥¼ ìƒì„±í•©ë‹ˆë‹¤</div>

    <div class="grid-2">
      <div class="card">
        <div class="card-title">ğŸ‘¤ ì§ì› ë° ê¸‰ì—¬ ì •ë³´</div>
        <div class="form-group">
          <label>ì§ì› ì´ë¦„</label>
          <input type="text" id="empName" placeholder="í™ê¸¸ë™">
        </div>
        <div class="form-group">
          <label>ë¶€ì„œ</label>
          <input type="text" id="empDept" placeholder="ê²½ì˜ì§€ì›íŒ€">
        </div>
        <div class="form-group">
          <label>ì§€ê¸‰ ì—°ì›”</label>
          <input type="month" id="slipMonth" value="2025-01">
        </div>
        <div class="form-group">
          <label>ê¸°ë³¸ê¸‰ (ì›)</label>
          <input type="number" id="slipBaseSalary" value="3000000">
        </div>
        <div class="form-group">
          <label>ì‹ëŒ€ (ì›)</label>
          <input type="number" id="slipMeal" value="200000">
        </div>
        <div class="form-group">
          <label>êµí†µë¹„ (ì›)</label>
          <input type="number" id="slipTransport" value="100000">
        </div>
        <div class="form-group">
          <label>ì—°ì¥ê·¼ë¬´ìˆ˜ë‹¹ (ì›)</label>
          <input type="number" id="slipOvertime" value="0">
        </div>
        <div class="form-group">
          <label>ë¶€ì–‘ê°€ì¡± ìˆ˜ (ë³¸ì¸ í¬í•¨)</label>
          <input type="number" id="slipDependents" value="1" min="1">
        </div>
        <button class="btn btn-primary" style="width:100%" onclick="generatePayslip()">
          ğŸ’° ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„±
        </button>
      </div>

      <div>
        <div class="card" id="payslipCard" style="display:none;">
          <div class="card-title">ğŸ“„ ê¸‰ì—¬ëª…ì„¸ì„œ ë¯¸ë¦¬ë³´ê¸°</div>
          <div class="payslip" id="payslipContent"></div>
          <div style="margin-top:14px; display:flex; gap:8px;">
            <button class="btn btn-primary" onclick="printPayslip()">ğŸ–¨ï¸ ì¸ì‡„</button>
            <button class="btn btn-secondary" onclick="aiEnhancePayslip()">ğŸ¤– AI ê²€í†  ìš”ì²­</button>
          </div>
        </div>

        <div class="card" id="payslipPlaceholder">
          <div style="text-align:center; padding:40px 0; color:var(--text-muted);">
            <div style="font-size:48px; margin-bottom:12px;">ğŸ’°</div>
            <div>ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ìƒì„±í•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ê°„ì´ì§€ê¸‰ëª…ì„¸ì„œ -->
  <div class="main" id="page-simplified">
    <div class="page-title">ê°„ì´ì§€ê¸‰ëª…ì„¸ì„œ ì‹ ê³ </div>
    <div class="page-sub">ìƒìš©ê·¼ë¡œì ë°˜ê¸°ë³„ / ì¼ìš©ê·¼ë¡œìÂ·ì‚¬ì—…ì†Œë“ì ë§¤ì›” ì œì¶œ (í™ˆíƒìŠ¤ ì‹ ê³  ê°€ì´ë“œ)</div>

    <div class="tabs">
      <div class="tab active" onclick="switchTabGeneric(this, 'simp-tabs', 'simp-input')">ğŸ“ ëª…ì„¸ì„œ ì‘ì„±</div>
      <div class="tab" onclick="switchTabGeneric(this, 'simp-tabs', 'simp-guide')">ğŸ“‹ ì‹ ê³  ì ˆì°¨ ì•ˆë‚´</div>
      <div class="tab" onclick="switchTabGeneric(this, 'simp-tabs', 'simp-preview')">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</div>
    </div>

    <div id="simp-input">
      <div class="grid-2">
        <div class="card">
          <div class="card-title">ğŸ¢ ì‚¬ì—…ì ì •ë³´</div>
          <div class="form-group">
            <label>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</label>
            <input type="text" id="simpBizNo" placeholder="000-00-00000">
          </div>
          <div class="form-group">
            <label>ìƒí˜¸(ë²•ì¸ëª…)</label>
            <input type="text" id="simpBizName" placeholder="(ì£¼)ì˜ˆì‹œíšŒì‚¬">
          </div>
          <div class="form-group">
            <label>ëŒ€í‘œìëª…</label>
            <input type="text" id="simpRepName" placeholder="í™ê¸¸ë™">
          </div>
          <div class="form-group">
            <label>ì‹ ê³  ìœ í˜•</label>
            <select id="simpType">
              <option value="half_employed">ìƒìš©ê·¼ë¡œì†Œë“ (ë°˜ê¸°ë³„)</option>
              <option value="daily">ì¼ìš©ê·¼ë¡œì†Œë“ (ë§¤ì›”)</option>
              <option value="business">ì‚¬ì—…ì†Œë“ (ë§¤ì›”)</option>
            </select>
          </div>
          <div class="form-group">
            <label>ê·€ì† ê¸°ê°„</label>
            <select id="simpPeriod">
              <option value="2025-H1">2025ë…„ ìƒë°˜ê¸° (1~6ì›”)</option>
              <option value="2025-H2">2025ë…„ í•˜ë°˜ê¸° (7~12ì›”)</option>
              <option value="2024-H2">2024ë…„ í•˜ë°˜ê¸° (7~12ì›”)</option>
            </select>
          </div>
        </div>

        <div class="card">
          <div class="card-title">ğŸ‘¥ ê·¼ë¡œì ëª…ì„¸ ì…ë ¥</div>
          <div id="simpEmpList">
            <div class="simp-emp-row" style="border:1px solid var(--border); border-radius:8px; padding:12px; margin-bottom:10px;">
              <div class="grid-2" style="gap:8px;">
                <div class="form-group" style="margin-bottom:8px;">
                  <label>ì„±ëª…</label>
                  <input type="text" class="simp-name" placeholder="í™ê¸¸ë™">
                </div>
                <div class="form-group" style="margin-bottom:8px;">
                  <label>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸</label>
                  <input type="text" class="simp-ssn" placeholder="000000-0000000">
                </div>
                <div class="form-group" style="margin-bottom:8px;">
                  <label>ì´ê¸‰ì—¬ (ì›)</label>
                  <input type="number" class="simp-salary" placeholder="18000000">
                </div>
                <div class="form-group" style="margin-bottom:8px;">
                  <label>ì†Œë“ì„¸ (ì›)</label>
                  <input type="number" class="simp-tax" placeholder="200000">
                </div>
              </div>
            </div>
          </div>
          <button class="btn btn-secondary" style="width:100%; margin-bottom:10px;" onclick="addSimpEmpRow()">+ ê·¼ë¡œì ì¶”ê°€</button>
          <button class="btn btn-primary" style="width:100%;" onclick="generateSimpStatement()">ğŸ“‘ ê°„ì´ì§€ê¸‰ëª…ì„¸ì„œ ìƒì„±</button>
        </div>
      </div>
    </div>

    <div id="simp-guide" style="display:none;">
      <div class="card">
        <div class="card-title">ğŸ“‹ ê°„ì´ì§€ê¸‰ëª…ì„¸ì„œ ì‹ ê³  ì ˆì°¨ (í™ˆíƒìŠ¤)</div>
        <div style="display:grid; gap:12px;">
          <div style="display:flex; gap:14px; align-items:flex-start;">
            <div style="width:28px; height:28px; border-radius:50%; background:var(--accent); color:#0a0e1a; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:13px; flex-shrink:0;">1</div>
            <div>
              <div style="font-weight:600; margin-bottom:4px;">í™ˆíƒìŠ¤ ì ‘ì† ë° ë¡œê·¸ì¸</div>
              <div style="color:var(--text-muted); font-size:13px;">hometax.go.kr ì ‘ì† â†’ ê³µë™ì¸ì¦ì„œÂ·ê°„í¸ì¸ì¦ìœ¼ë¡œ ë¡œê·¸ì¸</div>
            </div>
          </div>
          <div style="display:flex; gap:14px; align-items:flex-start;">
            <div style="width:28px; height:28px; border-radius:50%; background:var(--accent); color:#0a0e1a; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:13px; flex-shrink:0;">2</div>
            <div>
              <div style="font-weight:600; margin-bottom:4px;">ë©”ë‰´ ì´ë™</div>
              <div style="color:var(--text-muted); font-size:13px;">ì‹ ê³ /ë‚©ë¶€ â†’ ì§€ê¸‰ëª…ì„¸ì„œ â†’ <strong style="color:var(--accent)">ê°„ì´ì§€ê¸‰ëª…ì„¸ì„œ ì œì¶œ</strong></div>
            </div>
          </div>
          <div style="display:flex; gap:14px; align-items:flex-start;">
            <div style="width:28px; height:28px; border-radius:50%; background:var(--accent); color:#0a0e1a; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:13px; flex-shrink:0;">3</div>
            <div>
              <div style="font-weight:600; margin-bottom:4px;">ì‹ ê³  ìœ í˜• ì„ íƒ</div>
              <div style="color:var(--text-muted); font-size:13px;">ê·¼ë¡œì†Œë“(ìƒìš©) / ì¼ìš©ê·¼ë¡œì†Œë“ / ì‚¬ì—…ì†Œë“ ì¤‘ ì„ íƒ</div>
            </div>
          </div>
          <div style="display:flex; gap:14px; align-items:flex-start;">
            <div style="width:28px; height:28px; border-radius:50%; background:var(--accent); color:#0a0e1a; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:13px; flex-shrink:0;">4</div>
            <div>
              <div style="font-weight:600; margin-bottom:4px;">ê·¼ë¡œì ì •ë³´ ì…ë ¥ ë˜ëŠ” íŒŒì¼ ì—…ë¡œë“œ</div>
              <div style="color:var(--text-muted); font-size:13px;">ì§ì ‘ ì…ë ¥ ë˜ëŠ” CSV/TXT íŒŒì¼ ì¼ê´„ ì—…ë¡œë“œ (10ì¸ ì´ìƒ ê¶Œì¥)</div>
            </div>
          </div>
          <div style="display:flex; gap:14px; align-items:flex-start;">
            <div style="width:28px; height:28px; border-radius:50%; background:var(--accent); color:#0a0e1a; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:13px; flex-shrink:0;">5</div>
            <div>
              <div style="font-weight:600; margin-bottom:4px;">ì œì¶œ ì™„ë£Œ ë° ì ‘ìˆ˜ì¦ ì €ì¥</div>
              <div style="color:var(--text-muted); font-size:13px;">ì œì¶œ í›„ ì ‘ìˆ˜ë²ˆí˜¸ í™•ì¸ ë° ì ‘ìˆ˜ì¦ PDF ì €ì¥</div>
            </div>
          </div>
        </div>
        <div style="margin-top:16px; background:rgba(245,158,11,0.1); border:1px solid rgba(245,158,11,0.3); border-radius:8px; padding:12px;">
          <div style="color:var(--accent3); font-weight:700; margin-bottom:6px;">âš ï¸ ì œì¶œ ê¸°í•œ ì£¼ì˜</div>
          <div style="font-size:13px; color:var(--text-muted);">
            â€¢ ìƒìš©ê·¼ë¡œì†Œë“: ìƒë°˜ê¸°(1~6ì›”) â†’ 7ì›” 31ì¼ / í•˜ë°˜ê¸°(7~12ì›”) â†’ ë‹¤ìŒí•´ 1ì›” 31ì¼<br>
            â€¢ ì¼ìš©ê·¼ë¡œÂ·ì‚¬ì—…ì†Œë“: ì§€ê¸‰ì›” ë‹¤ìŒë‹¬ ë§ì¼ê¹Œì§€<br>
            â€¢ ë¯¸ì œì¶œ ì‹œ ê±´ë‹¹ <strong style="color:var(--danger)">20ë§Œì›</strong> ê°€ì‚°ì„¸ ë¶€ê³¼
          </div>
        </div>
        <div style="margin-top:12px;">
          <button class="btn btn-primary" onclick="generateSimpGuideAI()">ğŸ¤– AI ìƒì„¸ ì•ˆë‚´ ë°›ê¸°</button>
        </div>
        <div class="result-box" id="simpGuideResult" style="margin-top:12px; display:none;"></div>
      </div>
    </div>

    <div id="simp-preview" style="display:none;">
      <div class="card" id="simpPreviewCard">
        <div style="text-align:center; padding:40px 0; color:var(--text-muted);">
          <div style="font-size:48px; margin-bottom:12px;">ğŸ“‘</div>
          <div>ëª…ì„¸ì„œ ì‘ì„± íƒ­ì—ì„œ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ìƒì„±í•˜ì„¸ìš”</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ê·¼ë¡œì†Œë“ì§€ê¸‰ëª…ì„¸ì„œ -->
  <div class="main" id="page-annual">
    <div class="page-title">ê·¼ë¡œì†Œë“ ì§€ê¸‰ëª…ì„¸ì„œ ì‹ ê³ </div>
    <div class="page-sub">ì—°ê°„ ê·¼ë¡œì†Œë“ ì§€ê¸‰ëª…ì„¸ì„œ â€” ë§¤ë…„ 3ì›” 10ì¼ê¹Œì§€ í™ˆíƒìŠ¤ ì œì¶œ</div>

    <div class="tabs">
      <div class="tab active" onclick="switchTabGeneric(this, 'annual-tabs', 'annual-input')">ğŸ“ ëª…ì„¸ì„œ ì‘ì„±</div>
      <div class="tab" onclick="switchTabGeneric(this, 'annual-tabs', 'annual-guide')">ğŸ“‹ ì‹ ê³  ì ˆì°¨ ì•ˆë‚´</div>
      <div class="tab" onclick="switchTabGeneric(this, 'annual-tabs', 'annual-preview')">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</div>
    </div>

    <div id="annual-input">
      <div class="grid-2">
        <div class="card">
          <div class="card-title">ğŸ¢ ì›ì²œì§•ìˆ˜ì˜ë¬´ì ì •ë³´</div>
          <div class="form-group">
            <label>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</label>
            <input type="text" id="annualBizNo" placeholder="000-00-00000">
          </div>
          <div class="form-group">
            <label>ìƒí˜¸(ë²•ì¸ëª…)</label>
            <input type="text" id="annualBizName" placeholder="(ì£¼)ì˜ˆì‹œíšŒì‚¬">
          </div>
          <div class="form-group">
            <label>ëŒ€í‘œìëª…</label>
            <input type="text" id="annualRepName" placeholder="í™ê¸¸ë™">
          </div>
          <div class="form-group">
            <label>ê·€ì† ì—°ë„</label>
            <select id="annualYear">
              <option value="2024">2024ë…„</option>
              <option value="2023">2023ë…„</option>
            </select>
          </div>
          <div class="form-group">
            <label>ê·¼ë¬´ì§€ ìœ í˜•</label>
            <select id="annualWorkType">
              <option value="main">ì£¼(í˜„) ê·¼ë¬´ì§€</option>
              <option value="sub">ì¢…(ì „) ê·¼ë¬´ì§€</option>
            </select>
          </div>
        </div>

        <div class="card">
          <div class="card-title">ğŸ‘¤ ê·¼ë¡œì ì—°ê°„ ì†Œë“ ì •ë³´</div>
          <div id="annualEmpList">
            <div class="annual-emp-row" style="border:1px solid var(--border); border-radius:8px; padding:12px; margin-bottom:10px;">
              <div class="grid-2" style="gap:8px;">
                <div class="form-group" style="margin-bottom:8px;">
                  <label>ì„±ëª…</label>
                  <input type="text" class="ann-name" placeholder="í™ê¸¸ë™">
                </div>
                <div class="form-group" style="margin-bottom:8px;">
                  <label>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸</label>
                  <input type="text" class="ann-ssn" placeholder="000000-0000000">
                </div>
                <div class="form-group" style="margin-bottom:8px;">
                  <label>ì´ê¸‰ì—¬ (ì›)</label>
                  <input type="number" class="ann-gross" placeholder="36000000">
                </div>
                <div class="form-group" style="margin-bottom:8px;">
                  <label>ê·¼ë¡œì†Œë“ê³µì œ (ì›)</label>
                  <input type="number" class="ann-deduct" placeholder="12750000">
                </div>
                <div class="form-group" style="margin-bottom:8px;">
                  <label>ê²°ì •ì„¸ì•¡ (ì›)</label>
                  <input type="number" class="ann-final-tax" placeholder="800000">
                </div>
                <div class="form-group" style="margin-bottom:8px;">
                  <label>ê¸°ë‚©ë¶€ì„¸ì•¡ (ì›)</label>
                  <input type="number" class="ann-paid-tax" placeholder="850000">
                </div>
              </div>
              <div style="font-size:12px; color:var(--text-muted); margin-top:4px;">
                ê·¼ë¡œì†Œë“ê³µì œ ìë™ê³„ì‚°: <button class="btn btn-secondary" style="padding:3px 8px; font-size:11px;" onclick="autoCalcDeduction(this)">ìë™ê³„ì‚°</button>
              </div>
            </div>
          </div>
          <button class="btn btn-secondary" style="width:100%; margin-bottom:10px;" onclick="addAnnualEmpRow()">+ ê·¼ë¡œì ì¶”ê°€</button>
          <button class="btn btn-primary" style="width:100%;" onclick="generateAnnualStatement()">ğŸ“ƒ ì§€ê¸‰ëª…ì„¸ì„œ ìƒì„±</button>
        </div>
      </div>
    </div>

    <div id="annual-guide" style="display:none;">
      <div class="card">
        <div class="card-title">ğŸ“‹ ê·¼ë¡œì†Œë“ ì§€ê¸‰ëª…ì„¸ì„œ ì‹ ê³  ì ˆì°¨</div>
        <div style="display:grid; gap:12px;">
          <div style="display:flex; gap:14px; align-items:flex-start;">
            <div style="width:28px; height:28px; border-radius:50%; background:var(--accent2); color:white; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:13px; flex-shrink:0;">1</div>
            <div>
              <div style="font-weight:600; margin-bottom:4px;">ì—°ë§ì •ì‚° ì™„ë£Œ í›„ ì§„í–‰</div>
              <div style="color:var(--text-muted); font-size:13px;">2ì›” ê¸‰ì—¬ ì§€ê¸‰ ì‹œ ì—°ë§ì •ì‚° í™˜ê¸‰/ì¶”ê°€ì§•ìˆ˜ ë°˜ì˜ ì™„ë£Œ í›„ ì§„í–‰</div>
            </div>
          </div>
          <div style="display:flex; gap:14px; align-items:flex-start;">
            <div style="width:28px; height:28px; border-radius:50%; background:var(--accent2); color:white; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:13px; flex-shrink:0;">2</div>
            <div>
              <div style="font-weight:600; margin-bottom:4px;">í™ˆíƒìŠ¤ ë©”ë‰´ ì ‘ì†</div>
              <div style="color:var(--text-muted); font-size:13px;">ì‹ ê³ /ë‚©ë¶€ â†’ ì§€ê¸‰ëª…ì„¸ì„œ â†’ <strong style="color:var(--accent2)">ê·¼ë¡œì†Œë“ ì§€ê¸‰ëª…ì„¸ì„œ ì œì¶œ</strong></div>
            </div>
          </div>
          <div style="display:flex; gap:14px; align-items:flex-start;">
            <div style="width:28px; height:28px; border-radius:50%; background:var(--accent2); color:white; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:13px; flex-shrink:0;">3</div>
            <div>
              <div style="font-weight:600; margin-bottom:4px;">ì›ì²œì§•ìˆ˜ì˜ìˆ˜ì¦ ë‚´ìš© ì…ë ¥</div>
              <div style="color:var(--text-muted); font-size:13px;">ì´ê¸‰ì—¬, ê·¼ë¡œì†Œë“ê³µì œ, ê°ì¢… ì†Œë“Â·ì„¸ì•¡ê³µì œ, ê²°ì •ì„¸ì•¡, ê¸°ë‚©ë¶€ì„¸ì•¡ ì…ë ¥</div>
            </div>
          </div>
          <div style="display:flex; gap:14px; align-items:flex-start;">
            <div style="width:28px; height:28px; border-radius:50%; background:var(--accent2); color:white; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:13px; flex-shrink:0;">4</div>
            <div>
              <div style="font-weight:600; margin-bottom:4px;">íŒŒì¼ ì—…ë¡œë“œ (ë‹¤ìˆ˜ ì§ì›)</div>
              <div style="color:var(--text-muted); font-size:13px;">êµ­ì„¸ì²­ ì œê³µ ì„œì‹ íŒŒì¼(.csv)ì„ ì‚¬ìš©í•´ ì¼ê´„ ì—…ë¡œë“œ ê°€ëŠ¥</div>
            </div>
          </div>
          <div style="display:flex; gap:14px; align-items:flex-start;">
            <div style="width:28px; height:28px; border-radius:50%; background:var(--accent2); color:white; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:13px; flex-shrink:0;">5</div>
            <div>
              <div style="font-weight:600; margin-bottom:4px;">ì œì¶œ ë° ì ‘ìˆ˜ í™•ì¸</div>
              <div style="color:var(--text-muted); font-size:13px;">ì œì¶œ ì™„ë£Œ í›„ ì ‘ìˆ˜ë²ˆí˜¸ ì €ì¥, ê·¼ë¡œìì—ê²Œ ì›ì²œì§•ìˆ˜ì˜ìˆ˜ì¦ êµë¶€</div>
            </div>
          </div>
        </div>
        <div style="margin-top:16px; background:rgba(239,68,68,0.08); border:1px solid rgba(239,68,68,0.3); border-radius:8px; padding:12px;">
          <div style="color:var(--danger); font-weight:700; margin-bottom:6px;">ğŸš¨ ë§ˆê°ì¼ ë° ê°€ì‚°ì„¸</div>
          <div style="font-size:13px; color:var(--text-muted);">
            â€¢ ì œì¶œ ê¸°í•œ: ì§€ê¸‰ì—°ë„ ë‹¤ìŒí•´ <strong style="color:var(--danger)">3ì›” 10ì¼</strong>ê¹Œì§€<br>
            â€¢ ê¸°í•œ ë‚´ ë¯¸ì œì¶œ: ì§€ê¸‰ê¸ˆì•¡ì˜ <strong style="color:var(--danger)">1%</strong> ê°€ì‚°ì„¸<br>
            â€¢ ë¶ˆë¶„ëª… ê¸°ì¬: ì§€ê¸‰ê¸ˆì•¡ì˜ <strong style="color:var(--danger)">1%</strong> ê°€ì‚°ì„¸<br>
            â€¢ ì—°ë§ì •ì‚° í™˜ê¸‰ì„¸ì•¡ì€ ë‹¤ìŒ ë‹¬ ì›ì²œì„¸ ì‹ ê³  ì‹œ ì°¨ê°
          </div>
        </div>
        <div style="margin-top:12px; display:flex; gap:8px;">
          <button class="btn btn-primary" onclick="generateAnnualGuideAI()">ğŸ¤– AI ìƒì„¸ ì•ˆë‚´ ë°›ê¸°</button>
          <button class="btn btn-secondary" onclick="navigate('withholding')">ğŸ“‹ ì›ì²œì„¸ ì‹ ê³  ë°”ë¡œê°€ê¸°</button>
        </div>
        <div class="result-box" id="annualGuideResult" style="margin-top:12px; display:none;"></div>
      </div>
    </div>

    <div id="annual-preview" style="display:none;">
      <div class="card" id="annualPreviewCard">
        <div style="text-align:center; padding:40px 0; color:var(--text-muted);">
          <div style="font-size:48px; margin-bottom:12px;">ğŸ“ƒ</div>
          <div>ëª…ì„¸ì„œ ì‘ì„± íƒ­ì—ì„œ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ìƒì„±í•˜ì„¸ìš”</div>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
// â”€â”€ Date â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const now = new Date();
document.getElementById('headerDate').textContent =
  now.toLocaleDateString('ko-KR', {year:'numeric', month:'long', day:'numeric', weekday:'long'});

// â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function navigate(page) {
  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.main').forEach(el => el.classList.remove('active'));
  document.querySelector(`[data-page="${page}"]`).classList.add('active');
  document.getElementById(`page-${page}`).classList.add('active');
}

document.querySelectorAll('.nav-item').forEach(el => {
  el.addEventListener('click', () => navigate(el.dataset.page));
});

// â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(el, tabId) {
  el.closest('.tabs').querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  const parent = el.closest('.main');
  parent.querySelectorAll('[id^="wt-"]').forEach(t => t.style.display = 'none');
  document.getElementById(tabId).style.display = 'block';
}

// â”€â”€ 4ëŒ€ë³´í—˜ ê³„ì‚° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const INS_RATES = {
  pension: { emp: 0.045, emp_label: '4.5%', biz: 0.045, biz_label: '4.5%', name: 'êµ­ë¯¼ì—°ê¸ˆ' },
  health:  { emp: 0.03545, emp_label: '3.545%', biz: 0.03545, biz_label: '3.545%', name: 'ê±´ê°•ë³´í—˜' },
  ltc:     { emp: 0.00454, emp_label: '0.454%', biz: 0.00454, biz_label: '0.454%', name: 'ì¥ê¸°ìš”ì–‘ë³´í—˜' },
  employ:  { emp: 0.009, emp_label: '0.9%', biz: 0.0115, biz_label: '1.15%', name: 'ê³ ìš©ë³´í—˜' },
};

function calcInsurance() {
  const salary = parseInt(document.getElementById('baseSalary').value) || 0;
  const industryRate = parseFloat(document.getElementById('industryRate').value);

  let rows = '';
  let totalEmp = 0, totalBiz = 0;

  for (const [key, r] of Object.entries(INS_RATES)) {
    const base = key === 'ltc' ? Math.round(salary * 0.07090) : salary;
    const emp = Math.round(base * r.emp);
    const biz = Math.round(base * r.biz);
    totalEmp += emp;
    totalBiz += biz;
    rows += `<tr>
      <td>${r.name}</td>
      <td style="color:var(--text-muted)">${r.emp_label} / ${r.biz_label}</td>
      <td>${emp.toLocaleString()}ì›</td>
      <td>${biz.toLocaleString()}ì›</td>
    </tr>`;
  }

  const industryAmt = Math.round(salary * industryRate);
  totalBiz += industryAmt;
  rows += `<tr>
    <td>ì‚°ì¬ë³´í—˜</td>
    <td style="color:var(--text-muted)">0% / ${(industryRate*100).toFixed(1)}%</td>
    <td>-</td>
    <td>${industryAmt.toLocaleString()}ì›</td>
  </tr>`;

  rows += `<tr class="ins-row-total">
    <td colspan="2">í•©ê³„</td>
    <td>${totalEmp.toLocaleString()}ì›</td>
    <td>${totalBiz.toLocaleString()}ì›</td>
  </tr>`;

  document.getElementById('insTableBody').innerHTML = rows;
  document.getElementById('calcDate').textContent = `(${now.getFullYear()}ë…„ ê¸°ì¤€)`;
  document.getElementById('insResult').style.display = 'block';
  document.getElementById('insPlaceholder').style.display = 'none';
}

async function generateInsReport() {
  const salary = parseInt(document.getElementById('baseSalary').value) || 0;
  document.getElementById('insReport').style.display = 'block';
  document.getElementById('insReportContent').innerHTML = '<div class="loading"><span></span><span></span><span></span></div> AIê°€ ì‹ ê³ ì„œë¥¼ ì‘ì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...';

  const prompt = `ë‹¹ì‹ ì€ í•œêµ­ 4ëŒ€ë³´í—˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì•„ë˜ ì •ë³´ë¡œ 4ëŒ€ë³´í—˜ ì‹ ê³  ì•ˆë‚´ë¬¸ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.

ì›” ê¸‰ì—¬: ${salary.toLocaleString()}ì›
ê¸°ì¤€ ì—°ë„: 2025ë…„

ë‹¤ìŒì„ í¬í•¨í•´ ì£¼ì„¸ìš”:
1. 4ëŒ€ë³´í—˜ ë³´í—˜ë£Œ ìƒì„¸ ë‚´ì—­
2. ì‹ ê³  ê¸°ê´€ ë° ë°©ë²• (êµ­ë¯¼ê±´ê°•ë³´í—˜ê³µë‹¨, êµ­ë¯¼ì—°ê¸ˆê³µë‹¨, ê·¼ë¡œë³µì§€ê³µë‹¨)
3. ë‚©ë¶€ ê¸°í•œ
4. ìœ ì˜ì‚¬í•­`;

  await callClaude(prompt, 'insReportContent');
}

// â”€â”€ ì›ì²œì„¸ ê³„ì‚° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const WT_TABLE = [
  { min: 0, max: 14000000, rate: 0.06, deduct: 0 },
  { min: 14000000, max: 50000000, rate: 0.15, deduct: 1260000 },
  { min: 50000000, max: 88000000, rate: 0.24, deduct: 5760000 },
  { min: 88000000, max: 150000000, rate: 0.35, deduct: 15440000 },
  { min: 150000000, max: 300000000, rate: 0.38, deduct: 19940000 },
  { min: 300000000, max: 500000000, rate: 0.40, deduct: 25940000 },
  { min: 500000000, max: Infinity, rate: 0.42, deduct: 35940000 },
];

function calcWithholding() {
  const gross = parseInt(document.getElementById('totalPay').value) || 0;
  const incomeType = document.getElementById('incomeType').value;
  const deps = parseInt(document.getElementById('dependents').value) || 1;

  let incomeTax = 0, label = '';

  if (incomeType === 'salary') {
    // ê°„ì´ì„¸ì•¡í‘œ ê·¼ì‚¬ì¹˜ ê³„ì‚°
    const annual = gross * 12;
    const deduction = Math.min(annual * 0.7, 20000000); // ê·¼ë¡œì†Œë“ê³µì œ ê·¼ì‚¬
    const taxableIncome = Math.max(0, annual - deduction - (1500000 * deps));
    let annualTax = 0;
    for (const bracket of WT_TABLE) {
      if (taxableIncome > bracket.min) {
        annualTax = Math.min(taxableIncome, bracket.max) * bracket.rate - bracket.deduct;
      }
    }
    incomeTax = Math.max(0, Math.round(annualTax / 12));
    label = 'ê·¼ë¡œì†Œë“';
  } else if (incomeType === 'business') {
    incomeTax = Math.round(gross * 0.033);
    label = 'ì‚¬ì—…ì†Œë“';
  } else if (incomeType === 'etc') {
    const etcDeduction = Math.min(gross * 0.6, gross - 1500000);
    incomeTax = Math.max(0, Math.round((gross - etcDeduction) * 0.20));
    label = 'ê¸°íƒ€ì†Œë“';
  }

  const localTax = Math.round(incomeTax * 0.1);
  const total = incomeTax + localTax;
  const netPay = gross - total;

  const html = `
    <table class="ins-table">
      <tr><th>í•­ëª©</th><th>ê¸ˆì•¡</th></tr>
      <tr><td>ì´ ì§€ê¸‰ì•¡</td><td>${gross.toLocaleString()}ì›</td></tr>
      <tr><td>ì†Œë“ì„¸ (${label})</td><td style="color:var(--danger)">${incomeTax.toLocaleString()}ì›</td></tr>
      <tr><td>ì§€ë°©ì†Œë“ì„¸ (10%)</td><td style="color:var(--danger)">${localTax.toLocaleString()}ì›</td></tr>
      <tr class="ins-row-total"><td>ì›ì²œì§•ìˆ˜ í•©ê³„</td><td>${total.toLocaleString()}ì›</td></tr>
      <tr><td style="color:var(--success)">ì‹¤ìˆ˜ë ¹ì•¡</td><td style="color:var(--success); font-weight:700">${netPay.toLocaleString()}ì›</td></tr>
    </table>
    <div style="margin-top:12px;">
      <button class="btn btn-secondary" onclick="switchTab(document.querySelectorAll('.tab')[1], 'wt-report')">ğŸ“„ ì‹ ê³ ì„œ ì´ˆì•ˆ ìƒì„±</button>
    </div>`;

  document.getElementById('wtResult').innerHTML = `<div class="card-title">ğŸ’° ì›ì²œì§•ìˆ˜ì„¸ì•¡</div>` + html;
  document.getElementById('wtResult').style.display = 'block';
  document.getElementById('wtPlaceholder').style.display = 'none';
}

async function generateWTReport() {
  const reportType = document.getElementById('reportType').value;
  const month = document.getElementById('reportMonth').value;
  const count = document.getElementById('empCount').value;
  const total = parseInt(document.getElementById('totalPayAmount').value) || 0;

  document.getElementById('wtReportCard').style.display = 'block';
  document.getElementById('wtReportContent').innerHTML = '<div class="loading"><span></span><span></span><span></span></div>';

  const prompt = `í•œêµ­ ì›ì²œì„¸ ì‹ ê³  ì „ë¬¸ê°€ë¡œì„œ ì•„ë˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì›ì²œì„¸ ì‹ ê³ ì„œ ì‘ì„± ê°€ì´ë“œë¥¼ ì œê³µí•´ì£¼ì„¸ìš”.

ì‹ ê³  ìœ í˜•: ${reportType === 'monthly' ? 'ë§¤ì›” ì‹ ê³ ' : 'ë°˜ê¸° ì‹ ê³ '}
ê·€ì† ì—°ì›”: ${month}
ì§€ê¸‰ ì¸ì›: ${count}ëª…
ì´ ì§€ê¸‰ê¸ˆì•¡: ${total.toLocaleString()}ì›

í¬í•¨ ë‚´ìš©:
1. í™ˆíƒìŠ¤ ì‹ ê³  ì ˆì°¨ (ë‹¨ê³„ë³„)
2. ì˜ˆìƒ ì†Œë“ì„¸ ë° ì§€ë°©ì†Œë“ì„¸ (ì´ì•¡ì˜ ì•½ 3.3% ê¸°ì¤€)
3. ë‚©ë¶€ ê¸°í•œ ë° ê°€ì‚°ì„¸ ì£¼ì˜ì‚¬í•­
4. ì‹ ê³  ì‹œ ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜`;

  await callClaude(prompt, 'wtReportContent');
}

// â”€â”€ ê¸‰ì—¬ëª…ì„¸ì„œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generatePayslip() {
  const name = document.getElementById('empName').value || 'í™ê¸¸ë™';
  const dept = document.getElementById('empDept').value || 'ë¯¸ì…ë ¥';
  const month = document.getElementById('slipMonth').value;
  const base = parseInt(document.getElementById('slipBaseSalary').value) || 0;
  const meal = parseInt(document.getElementById('slipMeal').value) || 0;
  const transport = parseInt(document.getElementById('slipTransport').value) || 0;
  const overtime = parseInt(document.getElementById('slipOvertime').value) || 0;
  const deps = parseInt(document.getElementById('slipDependents').value) || 1;

  const gross = base + meal + transport + overtime;

  // 4ëŒ€ë³´í—˜ (ê¸°ë³¸ê¸‰ ê¸°ì¤€)
  const pension = Math.round(base * 0.045);
  const health = Math.round(base * 0.03545);
  const ltc = Math.round(base * 0.07090 * 0.00454);
  const employ = Math.round(base * 0.009);

  // ì†Œë“ì„¸ ê·¼ì‚¬ (ê°„ì´ì„¸ì•¡í‘œ)
  const annual = base * 12;
  const deduction = Math.min(annual * 0.7, 20000000);
  const taxable = Math.max(0, annual - deduction - (1500000 * deps));
  let annualTax = 0;
  for (const b of WT_TABLE) {
    if (taxable > b.min) annualTax = Math.min(taxable, b.max) * b.rate - b.deduct;
  }
  const incomeTax = Math.max(0, Math.round(annualTax / 12));
  const localTax = Math.round(incomeTax * 0.1);

  const totalDeduction = pension + health + ltc + employ + incomeTax + localTax;
  const netPay = gross - totalDeduction;
  const [y, m] = month.split('-');

  const html = `
    <h3>${y}ë…„ ${m}ì›” ê¸‰ì—¬ëª…ì„¸ì„œ</h3>
    <table>
      <tr><th colspan="2">ì¸ì  ì‚¬í•­</th></tr>
      <tr><td>ì„±ëª…</td><td>${name}</td></tr>
      <tr><td>ë¶€ì„œ</td><td>${dept}</td></tr>
      <tr><td>ì§€ê¸‰ì¼</td><td>${y}ë…„ ${m}ì›” 25ì¼</td></tr>
    </table>
    <table>
      <tr><th>ì§€ê¸‰ í•­ëª©</th><th>ê¸ˆì•¡</th><th>ê³µì œ í•­ëª©</th><th>ê¸ˆì•¡</th></tr>
      <tr><td>ê¸°ë³¸ê¸‰</td><td>${base.toLocaleString()}</td><td>êµ­ë¯¼ì—°ê¸ˆ</td><td>${pension.toLocaleString()}</td></tr>
      <tr><td>ì‹ëŒ€</td><td>${meal.toLocaleString()}</td><td>ê±´ê°•ë³´í—˜</td><td>${health.toLocaleString()}</td></tr>
      <tr><td>êµí†µë¹„</td><td>${transport.toLocaleString()}</td><td>ì¥ê¸°ìš”ì–‘ë³´í—˜</td><td>${ltc.toLocaleString()}</td></tr>
      <tr><td>ì—°ì¥ìˆ˜ë‹¹</td><td>${overtime.toLocaleString()}</td><td>ê³ ìš©ë³´í—˜</td><td>${employ.toLocaleString()}</td></tr>
      <tr><td></td><td></td><td>ì†Œë“ì„¸</td><td>${incomeTax.toLocaleString()}</td></tr>
      <tr><td></td><td></td><td>ì§€ë°©ì†Œë“ì„¸</td><td>${localTax.toLocaleString()}</td></tr>
      <tr class="total-row"><td>ì§€ê¸‰ í•©ê³„</td><td>${gross.toLocaleString()}</td><td>ê³µì œ í•©ê³„</td><td>${totalDeduction.toLocaleString()}</td></tr>
    </table>
    <table>
      <tr class="total-row"><th colspan="2">ì‹¤ìˆ˜ë ¹ì•¡</th><th colspan="2" style="font-size:15px">${netPay.toLocaleString()} ì›</th></tr>
    </table>
    <p style="text-align:center; margin-top:12px; color:#666; font-size:11px;">* ë³¸ ëª…ì„¸ì„œëŠ” ìë™ ê³„ì‚° ê²°ê³¼ì´ë©°, ì‹¤ì œ ê¸ˆì•¡ê³¼ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>`;

  document.getElementById('payslipContent').innerHTML = html;
  document.getElementById('payslipCard').style.display = 'block';
  document.getElementById('payslipPlaceholder').style.display = 'none';
}

function printPayslip() {
  const content = document.getElementById('payslipContent').innerHTML;
  const win = window.open('', '_blank');
  win.document.write(`<html><head><title>ê¸‰ì—¬ëª…ì„¸ì„œ</title>
    <style>
      body { font-family: 'Noto Sans KR', sans-serif; padding: 40px; font-size: 13px; }
      table { width: 100%; border-collapse: collapse; margin-bottom: 16px; }
      th, td { border: 1px solid #ccc; padding: 6px 10px; }
      th { background: #f0f0f0; font-weight: 700; }
      .total-row { font-weight: 700; background: #e8f5e9; }
      h3 { text-align: center; margin-bottom: 20px; font-size: 18px; border-bottom: 2px solid #000; padding-bottom: 10px; }
    </style></head><body>${content}</body></html>`);
  win.document.close();
  win.print();
}

async function aiEnhancePayslip() {
  navigate('chat');
  document.getElementById('chatInput').value = 'ë°©ê¸ˆ ìƒì„±ëœ ê¸‰ì—¬ëª…ì„¸ì„œë¥¼ ê²€í† í•´ì£¼ì„¸ìš”. ì„¸ê¸ˆ ê³„ì‚°ì´ ë§ëŠ”ì§€ í™•ì¸í•˜ê³  ì£¼ì˜ì‚¬í•­ì„ ì•Œë ¤ì£¼ì„¸ìš”.';
  sendChat();
}

// â”€â”€ AI Chat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function sendChat() {
  const input = document.getElementById('chatInput');
  const msg = input.value.trim();
  if (!msg) return;

  appendMsg(msg, 'user');
  input.value = '';

  const aiDiv = appendMsg('<div class="loading"><span></span><span></span><span></span></div>', 'ai');

  const systemPrompt = `ë‹¹ì‹ ì€ í•œêµ­ ê¸‰ì—¬Â·ì„¸ê¸ˆ ì „ë¬¸ AI ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤. ë‹¤ìŒ ë¶„ì•¼ë¥¼ ì „ë¬¸ìœ¼ë¡œ í•©ë‹ˆë‹¤:
- 4ëŒ€ë³´í—˜ (êµ­ë¯¼ì—°ê¸ˆ, ê±´ê°•ë³´í—˜, ê³ ìš©ë³´í—˜, ì‚°ì¬ë³´í—˜) ì‹ ê³  ë° ê³„ì‚°
- ì›ì²œì„¸ ì‹ ê³  (ì†Œë“ì„¸, ì§€ë°©ì†Œë“ì„¸)
- ê¸‰ì—¬ ëª…ì„¸ì„œ ì‘ì„±
- ì„¸ë¬´Â·ë…¸ë¬´ ê´€ë ¨ ë²•ê·œ ì•ˆë‚´

í•­ìƒ í•œêµ­ì–´ë¡œ ë‹µë³€í•˜ê³ , êµ¬ì²´ì ì¸ ìˆ˜ì¹˜ì™€ ì‹ ê³  ì ˆì°¨ë¥¼ í¬í•¨í•˜ì„¸ìš”. 
ë³µì¡í•œ ì„¸ë¬´ ë¬¸ì œëŠ” ì „ë¬¸ ì„¸ë¬´ì‚¬ ìƒë‹´ì„ ê¶Œì¥í•˜ì„¸ìš”.`;

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        system: systemPrompt,
        messages: [{ role: 'user', content: msg }]
      })
    });
    const data = await response.json();
    const text = data.content?.map(b => b.text).join('') || 'ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.';
    aiDiv.innerHTML = formatAIText(text);
  } catch (e) {
    aiDiv.innerHTML = 'âš ï¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
  }
}

function appendMsg(text, role) {
  const container = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className = `msg msg-${role}`;
  div.innerHTML = role === 'ai' ? formatAIText(text) : text;
  container.appendChild(div);
  container.scrollTop = container.scrollHeight;
  return div;
}

function formatAIText(text) {
  return text
    .replace(/```([\s\S]*?)```/g, '<pre>$1</pre>')
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/\n/g, '<br>');
}

document.getElementById('chatInput').addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendChat(); }
});

// â”€â”€ Claude API helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function callClaude(prompt, targetId) {
  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        messages: [{ role: 'user', content: prompt }]
      })
    });
    const data = await response.json();
    const text = data.content?.map(b => b.text).join('') || 'ì‘ë‹µ ì—†ìŒ';
    document.getElementById(targetId).innerHTML = formatAIText(text);
  } catch (e) {
    document.getElementById(targetId).innerHTML = 'âš ï¸ AI ì—°ê²° ì˜¤ë¥˜. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
  }
}

function copyReport(id) {
  const text = document.getElementById(id).innerText;
  navigator.clipboard.writeText(text).then(() => alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'));
}

// â”€â”€ Generic Tab Switcher â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTabGeneric(el, groupClass, targetId) {
  el.closest('.tabs').querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  const page = el.closest('.main');
  // hide all sibling tab content divs
  const allIds = {
    'simp-tabs': ['simp-input','simp-guide','simp-preview'],
    'annual-tabs': ['annual-input','annual-guide','annual-preview']
  };
  (allIds[groupClass] || []).forEach(id => {
    const el2 = document.getElementById(id);
    if (el2) el2.style.display = 'none';
  });
  document.getElementById(targetId).style.display = 'block';
}

// â”€â”€ ê°„ì´ì§€ê¸‰ëª…ì„¸ì„œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addSimpEmpRow() {
  const row = document.createElement('div');
  row.className = 'simp-emp-row';
  row.style.cssText = 'border:1px solid var(--border); border-radius:8px; padding:12px; margin-bottom:10px; position:relative;';
  row.innerHTML = `
    <button onclick="this.parentElement.remove()" style="position:absolute; top:8px; right:8px; background:var(--danger); border:none; color:white; width:20px; height:20px; border-radius:50%; cursor:pointer; font-size:12px;">âœ•</button>
    <div class="grid-2" style="gap:8px;">
      <div class="form-group" style="margin-bottom:8px;"><label>ì„±ëª…</label><input type="text" class="simp-name" placeholder="í™ê¸¸ë™"></div>
      <div class="form-group" style="margin-bottom:8px;"><label>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸</label><input type="text" class="simp-ssn" placeholder="000000-0000000"></div>
      <div class="form-group" style="margin-bottom:8px;"><label>ì´ê¸‰ì—¬ (ì›)</label><input type="number" class="simp-salary" placeholder="18000000"></div>
      <div class="form-group" style="margin-bottom:8px;"><label>ì†Œë“ì„¸ (ì›)</label><input type="number" class="simp-tax" placeholder="200000"></div>
    </div>`;
  document.getElementById('simpEmpList').appendChild(row);
}

function generateSimpStatement() {
  const bizNo = document.getElementById('simpBizNo').value || '000-00-00000';
  const bizName = document.getElementById('simpBizName').value || '(ì£¼)íšŒì‚¬ëª…';
  const repName = document.getElementById('simpRepName').value || 'ëŒ€í‘œì';
  const typeMap = {half_employed:'ê·¼ë¡œì†Œë“(ìƒìš©)', daily:'ì¼ìš©ê·¼ë¡œì†Œë“', business:'ì‚¬ì—…ì†Œë“'};
  const type = typeMap[document.getElementById('simpType').value];
  const period = document.getElementById('simpPeriod').value;
  const periodLabel = period === '2025-H1' ? '2025ë…„ ìƒë°˜ê¸°(1ì›”~6ì›”)' :
                      period === '2025-H2' ? '2025ë…„ í•˜ë°˜ê¸°(7ì›”~12ì›”)' : '2024ë…„ í•˜ë°˜ê¸°(7ì›”~12ì›”)';

  const rows = document.querySelectorAll('.simp-emp-row');
  let empData = [], totalSalary = 0, totalTax = 0;
  rows.forEach(row => {
    const name = row.querySelector('.simp-name')?.value || '-';
    const ssn = row.querySelector('.simp-ssn')?.value || '-';
    const salary = parseInt(row.querySelector('.simp-salary')?.value) || 0;
    const tax = parseInt(row.querySelector('.simp-tax')?.value) || 0;
    const localTax = Math.round(tax * 0.1);
    totalSalary += salary;
    totalTax += tax + localTax;
    empData.push({name, ssn, salary, tax, localTax});
  });

  const previewHtml = `
    <div class="card-title">ğŸ“‘ ê°„ì´ì§€ê¸‰ëª…ì„¸ì„œ ë¯¸ë¦¬ë³´ê¸°</div>
    <div class="payslip" style="max-width:100%;">
      <h3>ê°„ì´ì§€ê¸‰ëª…ì„¸ì„œ (${type})</h3>
      <table>
        <tr><th>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</th><td>${bizNo}</td><th>ìƒí˜¸</th><td>${bizName}</td></tr>
        <tr><th>ëŒ€í‘œì</th><td>${repName}</td><th>ê·€ì†ê¸°ê°„</th><td>${periodLabel}</td></tr>
      </table>
      <table>
        <tr><th>ì„±ëª…</th><th>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸</th><th>ì´ê¸‰ì—¬</th><th>ì†Œë“ì„¸</th><th>ì§€ë°©ì†Œë“ì„¸</th><th>í•©ê³„</th></tr>
        ${empData.map(e => `<tr>
          <td>${e.name}</td>
          <td>${e.ssn.replace(/(\d{6})-?(\d)(\d{6})/, '$1-$2******')}</td>
          <td>${e.salary.toLocaleString()}</td>
          <td>${e.tax.toLocaleString()}</td>
          <td>${e.localTax.toLocaleString()}</td>
          <td>${(e.tax+e.localTax).toLocaleString()}</td>
        </tr>`).join('')}
        <tr class="total-row"><td colspan="2">í•©ê³„ (${empData.length}ëª…)</td><td>${totalSalary.toLocaleString()}</td><td colspan="2"></td><td>${totalTax.toLocaleString()}</td></tr>
      </table>
      <p style="text-align:center; margin-top:12px; color:#666; font-size:11px;">â€» ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ ë’·ìë¦¬ëŠ” ë³´ì•ˆ ì²˜ë¦¬ë˜ì–´ í‘œì‹œë©ë‹ˆë‹¤. ì‹¤ì œ ì œì¶œ ì‹œ ì „ì²´ ë²ˆí˜¸ ì…ë ¥ í•„ìš”.</p>
    </div>
    <div style="margin-top:14px; display:flex; gap:8px;">
      <button class="btn btn-primary" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„</button>
      <button class="btn btn-secondary" onclick="generateSimpAICheck()">ğŸ¤– AI ê²€í†  ìš”ì²­</button>
    </div>
    <div class="result-box" id="simpAICheckResult" style="margin-top:12px; display:none;"></div>`;

  document.getElementById('simpPreviewCard').innerHTML = previewHtml;
  // switch to preview tab
  document.querySelectorAll('#page-simplified .tab')[2].click();
}

async function generateSimpGuideAI() {
  const el = document.getElementById('simpGuideResult');
  el.style.display = 'block';
  el.innerHTML = '<div class="loading"><span></span><span></span><span></span></div>';
  const prompt = `í•œêµ­ ì„¸ë¬´ ì „ë¬¸ê°€ë¡œì„œ ê°„ì´ì§€ê¸‰ëª…ì„¸ì„œ ì‹ ê³ ì— ëŒ€í•´ ìƒì„¸íˆ ì•ˆë‚´í•´ì£¼ì„¸ìš”.
ë‹¤ìŒì„ í¬í•¨í•´ì£¼ì„¸ìš”:
1. ì œì¶œ ì˜ë¬´ì ë²”ìœ„
2. ìƒìš©/ì¼ìš©/ì‚¬ì—…ì†Œë“ë³„ ì œì¶œ ê¸°í•œ ì°¨ì´
3. í™ˆíƒìŠ¤ ì „ìì‹ ê³  ë‹¨ê³„ë³„ ë°©ë²•
4. ìì£¼ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ì™€ ìˆ˜ì • ë°©ë²•
5. ê°€ì‚°ì„¸ ë©´ì œ ìš”ê±´`;
  await callClaude(prompt, 'simpGuideResult');
}

async function generateSimpAICheck() {
  const el = document.getElementById('simpAICheckResult');
  el.style.display = 'block';
  el.innerHTML = '<div class="loading"><span></span><span></span><span></span></div>';
  const prompt = `ê°„ì´ì§€ê¸‰ëª…ì„¸ì„œ ì œì¶œ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸ì™€ ì£¼ì˜ì‚¬í•­ì„ ì •ë¦¬í•´ì£¼ì„¸ìš”. ì‹¤ë¬´ì—ì„œ ìì£¼ ì‹¤ìˆ˜í•˜ëŠ” ë¶€ë¶„ì„ ì¤‘ì‹¬ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ ì•ˆë‚´í•´ì£¼ì„¸ìš”.`;
  await callClaude(prompt, 'simpAICheckResult');
}

// â”€â”€ ê·¼ë¡œì†Œë“ì§€ê¸‰ëª…ì„¸ì„œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addAnnualEmpRow() {
  const row = document.createElement('div');
  row.className = 'annual-emp-row';
  row.style.cssText = 'border:1px solid var(--border); border-radius:8px; padding:12px; margin-bottom:10px; position:relative;';
  row.innerHTML = `
    <button onclick="this.parentElement.remove()" style="position:absolute; top:8px; right:8px; background:var(--danger); border:none; color:white; width:20px; height:20px; border-radius:50%; cursor:pointer; font-size:12px;">âœ•</button>
    <div class="grid-2" style="gap:8px;">
      <div class="form-group" style="margin-bottom:8px;"><label>ì„±ëª…</label><input type="text" class="ann-name" placeholder="í™ê¸¸ë™"></div>
      <div class="form-group" style="margin-bottom:8px;"><label>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸</label><input type="text" class="ann-ssn" placeholder="000000-0000000"></div>
      <div class="form-group" style="margin-bottom:8px;"><label>ì´ê¸‰ì—¬ (ì›)</label><input type="number" class="ann-gross" placeholder="36000000"></div>
      <div class="form-group" style="margin-bottom:8px;"><label>ê·¼ë¡œì†Œë“ê³µì œ (ì›)</label><input type="number" class="ann-deduct" placeholder="12750000"></div>
      <div class="form-group" style="margin-bottom:8px;"><label>ê²°ì •ì„¸ì•¡ (ì›)</label><input type="number" class="ann-final-tax" placeholder="800000"></div>
      <div class="form-group" style="margin-bottom:8px;"><label>ê¸°ë‚©ë¶€ì„¸ì•¡ (ì›)</label><input type="number" class="ann-paid-tax" placeholder="850000"></div>
    </div>
    <div style="font-size:12px; color:var(--text-muted); margin-top:4px;">
      ê·¼ë¡œì†Œë“ê³µì œ ìë™ê³„ì‚°: <button class="btn btn-secondary" style="padding:3px 8px; font-size:11px;" onclick="autoCalcDeduction(this)">ìë™ê³„ì‚°</button>
    </div>`;
  document.getElementById('annualEmpList').appendChild(row);
}

function autoCalcDeduction(btn) {
  const row = btn.closest('.annual-emp-row');
  const gross = parseInt(row.querySelector('.ann-gross')?.value) || 0;
  let deduction = 0;
  if (gross <= 5000000) deduction = gross * 0.7;
  else if (gross <= 15000000) deduction = 3500000 + (gross - 5000000) * 0.4;
  else if (gross <= 45000000) deduction = 7500000 + (gross - 15000000) * 0.15;
  else if (gross <= 100000000) deduction = 12000000 + (gross - 45000000) * 0.05;
  else deduction = 14750000 + (gross - 100000000) * 0.02;
  deduction = Math.min(deduction, 20000000);
  const deductEl = row.querySelector('.ann-deduct');
  if (deductEl) deductEl.value = Math.round(deduction);
}

function generateAnnualStatement() {
  const bizNo = document.getElementById('annualBizNo').value || '000-00-00000';
  const bizName = document.getElementById('annualBizName').value || '(ì£¼)íšŒì‚¬ëª…';
  const repName = document.getElementById('annualRepName').value || 'ëŒ€í‘œì';
  const year = document.getElementById('annualYear').value;
  const workType = document.getElementById('annualWorkType').value === 'main' ? 'ì£¼(í˜„)ê·¼ë¬´ì§€' : 'ì¢…(ì „)ê·¼ë¬´ì§€';

  const rows = document.querySelectorAll('.annual-emp-row');
  let empData = [], totalGross = 0, totalFinalTax = 0, totalPaidTax = 0;
  rows.forEach(row => {
    const name = row.querySelector('.ann-name')?.value || '-';
    const ssn = row.querySelector('.ann-ssn')?.value || '-';
    const gross = parseInt(row.querySelector('.ann-gross')?.value) || 0;
    const deduct = parseInt(row.querySelector('.ann-deduct')?.value) || 0;
    const finalTax = parseInt(row.querySelector('.ann-final-tax')?.value) || 0;
    const paidTax = parseInt(row.querySelector('.ann-paid-tax')?.value) || 0;
    const refund = paidTax - finalTax;
    totalGross += gross; totalFinalTax += finalTax; totalPaidTax += paidTax;
    empData.push({name, ssn, gross, deduct, taxableIncome: gross - deduct, finalTax, paidTax, refund});
  });

  const previewHtml = `
    <div class="card-title">ğŸ“ƒ ê·¼ë¡œì†Œë“ ì§€ê¸‰ëª…ì„¸ì„œ ë¯¸ë¦¬ë³´ê¸°</div>
    <div class="payslip" style="max-width:100%;">
      <h3>${year}ë…„ ê·€ì† ê·¼ë¡œì†Œë“ ì§€ê¸‰ëª…ì„¸ì„œ</h3>
      <table>
        <tr><th>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</th><td>${bizNo}</td><th>ìƒí˜¸</th><td>${bizName}</td></tr>
        <tr><th>ëŒ€í‘œì</th><td>${repName}</td><th>ê·¼ë¬´ì§€ êµ¬ë¶„</th><td>${workType}</td></tr>
      </table>
      <table>
        <tr><th>ì„±ëª…</th><th>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸</th><th>ì´ê¸‰ì—¬</th><th>ê·¼ë¡œì†Œë“ê³µì œ</th><th>ê³¼ì„¸í‘œì¤€</th><th>ê²°ì •ì„¸ì•¡</th><th>ê¸°ë‚©ë¶€ì„¸ì•¡</th><th>ì°¨ê°ì§•ìˆ˜(í™˜ê¸‰)</th></tr>
        ${empData.map(e => `<tr>
          <td>${e.name}</td>
          <td>${e.ssn.replace(/(\d{6})-?(\d)(\d{6})/, '$1-$2******')}</td>
          <td>${e.gross.toLocaleString()}</td>
          <td>${e.deduct.toLocaleString()}</td>
          <td>${e.taxableIncome.toLocaleString()}</td>
          <td>${e.finalTax.toLocaleString()}</td>
          <td>${e.paidTax.toLocaleString()}</td>
          <td style="color:${e.refund >= 0 ? 'var(--success)' : 'var(--danger)'}">${e.refund >= 0 ? 'í™˜ê¸‰ ' : 'ì¶”ê°€ë‚©ë¶€ '}${Math.abs(e.refund).toLocaleString()}</td>
        </tr>`).join('')}
        <tr class="total-row">
          <td colspan="2">í•©ê³„ (${empData.length}ëª…)</td>
          <td>${totalGross.toLocaleString()}</td>
          <td colspan="2"></td>
          <td>${totalFinalTax.toLocaleString()}</td>
          <td>${totalPaidTax.toLocaleString()}</td>
          <td style="color:${(totalPaidTax-totalFinalTax)>=0?'var(--success)':'var(--danger)'}">
            ${(totalPaidTax-totalFinalTax)>=0?'í™˜ê¸‰ ':'ì¶”ê°€ë‚©ë¶€ '}${Math.abs(totalPaidTax-totalFinalTax).toLocaleString()}
          </td>
        </tr>
      </table>
      <p style="text-align:center; margin-top:12px; color:#666; font-size:11px;">â€» ì´ ëª…ì„¸ì„œëŠ” í™ˆíƒìŠ¤ ì „ìì‹ ê³  ì „ ê²€í† ìš©ì…ë‹ˆë‹¤. ì‹¤ì œ ì‹ ê³ ëŠ” í™ˆíƒìŠ¤ì—ì„œ ì§„í–‰í•˜ì„¸ìš”.</p>
    </div>
    <div style="margin-top:14px; display:flex; gap:8px; flex-wrap:wrap;">
      <button class="btn btn-primary" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„</button>
      <button class="btn btn-secondary" onclick="generateAnnualAICheck()">ğŸ¤– AI ê²€í†  ìš”ì²­</button>
      <button class="btn btn-secondary" onclick="generateCSVExport()">ğŸ“Š CSV ë‚´ë³´ë‚´ê¸°</button>
    </div>
    <div class="result-box" id="annualAICheckResult" style="margin-top:12px; display:none;"></div>`;

  document.getElementById('annualPreviewCard').innerHTML = previewHtml;
  document.querySelectorAll('#page-annual .tab')[2].click();
}

async function generateAnnualGuideAI() {
  const el = document.getElementById('annualGuideResult');
  el.style.display = 'block';
  el.innerHTML = '<div class="loading"><span></span><span></span><span></span></div>';
  const prompt = `í•œêµ­ ì„¸ë¬´ ì „ë¬¸ê°€ë¡œì„œ ê·¼ë¡œì†Œë“ ì§€ê¸‰ëª…ì„¸ì„œ ì œì¶œì— ëŒ€í•´ ì‹¤ë¬´ ì¤‘ì‹¬ìœ¼ë¡œ ì•ˆë‚´í•´ì£¼ì„¸ìš”.
ë‹¤ìŒì„ í¬í•¨í•´ì£¼ì„¸ìš”:
1. ì—°ë§ì •ì‚°ê³¼ ì§€ê¸‰ëª…ì„¸ì„œì˜ ê´€ê³„
2. ì›ì²œì§•ìˆ˜ì˜ìˆ˜ì¦ vs ì§€ê¸‰ëª…ì„¸ì„œ ì°¨ì´ì 
3. í™ˆíƒìŠ¤ ì „ìì œì¶œ ë‹¨ê³„ë³„ ë°©ë²• (íŒŒì¼ ì—…ë¡œë“œ í¬í•¨)
4. ìˆ˜ì • ì œì¶œ ë°©ë²•
5. í‡´ì§ìÂ·ì¤‘ë„ì…ì‚¬ì ì²˜ë¦¬ ë°©ë²•`;
  await callClaude(prompt, 'annualGuideResult');
}

async function generateAnnualAICheck() {
  const el = document.getElementById('annualAICheckResult');
  el.style.display = 'block';
  el.innerHTML = '<div class="loading"><span></span><span></span><span></span></div>';
  const prompt = `ê·¼ë¡œì†Œë“ ì§€ê¸‰ëª…ì„¸ì„œ ì œì¶œ ì „ ìµœì¢… ì ê²€ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”. 
í™˜ê¸‰/ì¶”ê°€ë‚©ë¶€ ì²˜ë¦¬, ê³µì œí•­ëª© ëˆ„ë½, ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ ì˜¤ë¥˜ ë“± ì‹¤ë¬´ ì˜¤ë¥˜ ì¤‘ì‹¬ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ ì •ë¦¬í•´ì£¼ì„¸ìš”.`;
  await callClaude(prompt, 'annualAICheckResult');
}

function generateCSVExport() {
  const rows = document.querySelectorAll('.annual-emp-row');
  let csv = 'ì„±ëª…,ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸,ì´ê¸‰ì—¬,ê·¼ë¡œì†Œë“ê³µì œ,ê²°ì •ì„¸ì•¡,ê¸°ë‚©ë¶€ì„¸ì•¡\n';
  rows.forEach(row => {
    const name = row.querySelector('.ann-name')?.value || '';
    const ssn = row.querySelector('.ann-ssn')?.value || '';
    const gross = row.querySelector('.ann-gross')?.value || '';
    const deduct = row.querySelector('.ann-deduct')?.value || '';
    const finalTax = row.querySelector('.ann-final-tax')?.value || '';
    const paidTax = row.querySelector('.ann-paid-tax')?.value || '';
    csv += `${name},${ssn},${gross},${deduct},${finalTax},${paidTax}\n`;
  });
  const blob = new Blob(['\uFEFF' + csv], {type:'text/csv;charset=utf-8;'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'ê·¼ë¡œì†Œë“ì§€ê¸‰ëª…ì„¸ì„œ.csv';
  a.click();
}
</script>
</body>
</html>
